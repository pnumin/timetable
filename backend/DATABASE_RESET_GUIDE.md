# 데이터베이스 초기화 가이드

## 개요
이 가이드는 데이터베이스를 완전히 초기화하고 새로운 스키마로 재생성하는 방법을 설명합니다.

## 언제 사용하나요?

다음과 같은 경우에 데이터베이스 초기화가 필요합니다:
- 전체 테스트를 새로 시작하고 싶을 때
- 데이터베이스 스키마가 변경되었을 때
- 데이터가 손상되었거나 일관성이 깨졌을 때
- 개발 환경을 깨끗하게 리셋하고 싶을 때

## 초기화 방법

### 1. 완전 초기화 (권장)

모든 데이터를 삭제하고 새로운 스키마로 재생성합니다:

```bash
cd backend
npm run reset-db
```

이 명령은 다음을 수행합니다:
1. 기존의 모든 테이블 삭제
2. 새로운 스키마로 테이블 재생성 (is_exam 필드 포함)
3. 인덱스 생성

### 2. 데이터베이스 검증

초기화 후 스키마가 올바르게 생성되었는지 확인:

```bash
npm run verify-db
```

## 초기화 후 확인사항

초기화가 성공하면 다음과 같은 메시지가 표시됩니다:

```
=== 데이터베이스 초기화가 성공적으로 완료되었습니다 ===

생성된 테이블:
  - courses (교과목)
  - instructors (교관)
  - schedules (일정, is_exam 필드 포함)
  - off_days (휴무일)
```

## 테스트 시나리오

초기화 후 다음 순서로 테스트를 진행하세요:

### 1. 백엔드 서버 시작

```bash
npm run dev
```

### 2. 프론트엔드에서 테스트

1. **교과목 업로드**
   - 업로드 페이지에서 엑셀 파일 업로드
   - 교과목 데이터 확인

2. **교관 휴무일 설정** (선택사항)
   - 교관 휴무일 페이지에서 휴무일 추가

3. **선배정 설정** (선택사항)
   - 선배정 페이지에서 특정 과목 미리 배정

4. **시간표 자동 생성**
   - 시간표 생성 페이지에서 시작 날짜 선택
   - 생성 버튼 클릭
   - 결과 확인

5. **시간표 조회**
   - 시간표 조회 페이지에서 생성된 일정 확인
   - 일별/주별/월별 뷰로 확인
   - 시험 일정(is_exam=true) 확인

### 3. 자동화된 테스트 실행

알고리즘 개선 사항을 테스트하려면:

```bash
# 백엔드 서버가 실행 중인 상태에서 다른 터미널에서
node test-algorithm-improvements.js
```

이 테스트는 다음을 검증합니다:
- 연강 제한 (3시간 이상 연속 배정 방지)
- 평가 자동 배정 (평가=1인 과목 완료 후 2시간 시험 자동 배정)

## 주의사항

⚠️ **경고**: `npm run reset-db` 명령은 모든 데이터를 삭제합니다!
- 프로덕션 환경에서는 절대 사용하지 마세요
- 중요한 데이터가 있다면 백업을 먼저 하세요

## 문제 해결

### 데이터베이스 파일이 잠겨있는 경우

백엔드 서버가 실행 중이면 데이터베이스 파일이 잠길 수 있습니다:

1. 백엔드 서버 중지 (Ctrl+C)
2. `npm run reset-db` 실행
3. 백엔드 서버 재시작

### 스키마 변경 후 마이그레이션

기존 데이터를 유지하면서 스키마만 업데이트하려면:

```bash
npm run build
node dist/scripts/addIsExamColumn.js
```

## 추가 스크립트

### 데이터베이스 초기 생성 (테이블만 생성, 데이터 유지)

```bash
npm run init-db
```

이 명령은 테이블이 없을 때만 생성하고, 기존 데이터는 유지합니다.

## 데이터베이스 위치

SQLite 데이터베이스 파일 위치:
```
backend/database.sqlite
```

필요시 이 파일을 직접 삭제하고 `npm run init-db`를 실행할 수도 있습니다.
